@if (isLoading()) {
<section class="product-detail-page">
    <div class="container">
        <p style="text-align: center; padding: 4rem;">Loading product...</p>
    </div>
</section>
} @else if (product()) {
<section class="product-detail-page">
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a routerLink="/">Home</a>
            <span>/</span>
            <a routerLink="/products">Products</a>
            <span>/</span>
            <a [routerLink]="['/products']" [queryParams]="{category: product()!.category}">{{ product()!.category |
                titlecase
                }}</a>
            <span>/</span>
            <span class="current">{{ product()!.name }}</span>
        </nav>

        <!-- Product Main -->
        <div class="product-main">
            <div class="product-gallery">
                <div class="main-image">
                    <img [src]="product()!.image" [alt]="product()!.name">
                    <span class="category-badge">{{ getCategoryIcon() }} {{ product()!.category | titlecase }}</span>
                </div>
            </div>

            <div class="product-info">
                <div class="rating">
                    @for (star of [1,2,3,4,5]; track star) {
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        [attr.fill]="star <= product()!.rating ? 'currentColor' : 'none'" stroke="currentColor"
                        stroke-width="2">
                        <polygon
                            points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                        </polygon>
                    </svg>
                    }
                    <span class="rating-text">{{ product()!.rating }} / 5</span>
                </div>

                <h1>{{ product()!.name }}</h1>

                <p class="farmer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    by <strong>{{ product()!.farmer }}</strong>
                </p>

                <p class="description">{{ product()!.description }}</p>

                <div class="price-block">
                    <span class="price">Rs. {{ product()!.price }}</span>
                    <span class="unit">/ {{ product()!.unit }}</span>
                </div>

                <div class="stock-info" [class.low-stock]="product()!.stock < 20">
                    @if (product()!.stock > 20) {
                    <span class="in-stock">âœ“ In Stock ({{ product()!.stock }} available)</span>
                    } @else {
                    <span class="low-stock">âš  Low Stock (Only {{ product()!.stock }} left)</span>
                    }
                </div>

                <div class="add-to-cart-section">
                    <div class="quantity-selector">
                        <button (click)="decreaseQuantity()" [disabled]="quantity <= 1">âˆ’</button>
                        <span>{{ quantity }}</span>
                        <button (click)="increaseQuantity()" [disabled]="quantity >= product()!.stock">+</button>
                    </div>

                    <button class="btn btn-primary add-btn" (click)="addToCart()" [class.added]="addedToCart">
                        @if (addedToCart) {
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="3">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Added to Cart!
                        } @else {
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                        Add to Cart
                        }
                    </button>
                </div>

                <div class="features">
                    <div class="feature">
                        <span class="icon">ðŸšš</span>
                        <div>
                            <strong>Free Delivery</strong>
                            <small>On orders above Rs. 500</small>
                        </div>
                    </div>
                    <div class="feature">
                        <span class="icon">ðŸŒ¿</span>
                        <div>
                            <strong>Fresh Guarantee</strong>
                            <small>100% quality assured</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Products -->
        @if (relatedProducts().length > 0) {
        <section class="related-products">
            <h2>Related Products</h2>
            <div class="product-grid">
                @for (prod of relatedProducts(); track prod.id) {
                <app-product-card [product]="prod"></app-product-card>
                }
            </div>
        </section>
        }
    </div>
</section>
}